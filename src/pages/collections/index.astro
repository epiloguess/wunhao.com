---
import Layout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

import Login from "../../components/Login.astro";

const allPosts = await getCollection(
  "docs",
  (post) => post.data.draft == false
);
const uniqueFolder = allPosts.map((post) =>
  post.slug
    .split("/")
    .slice(0, post.slug.length - 2)
    .join("/")
);
---

<Layout title="Collections">
  <!-- <Login /> -->
  <div>
    {
      allPosts.map((post) => {
        const postLength = post.slug.split("/").length;
        const collection = post.slug.split("/")[postLength - 2];
        const postPathWithoutSelf = post.slug
          .split("/")
          .slice(0, postLength - 1)
          .join("/");

        const postAtSameFolder = allPosts.filter(
          (post) =>
            post.slug.startsWith(postPathWithoutSelf) &&
            (post.slug.split("/").length = postLength)
        );

        return (
          <section>
            {postAtSameFolder.map((post) => (
              <div>{post.id} </div>
            ))}
          </section>
        );
      })
    }
    <div>
      {uniqueFolder}
    </div>
  </div>
</Layout>

<style>
  details {
    border: 1px solid #aaa;
    border-radius: 4px;
    padding: 0.5em 0.5em 0;
  }
</style>
